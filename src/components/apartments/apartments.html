<div class="page-container" dir="rtl">
  <div class="content-wrapper">
    <!-- Header -->
    <div class="header-card">
      <div class="header-title">
        <svg class="icon-home" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
          <polyline points="9 22 9 12 15 12 15 22"/>
        </svg>
        <h1>דירות למכירה והשכרה</h1>
      </div>

      <!-- Type Selector -->
      <div class="type-selector">
        <button 
          (click)="setListingType('all')"
          [class.active]="listingType === 'all'"
          class="type-btn">
          הכל ({{ getTypeCount('all') }})
        </button>
        <button 
          (click)="setListingType('sale')"
          [class.active]="listingType === 'sale'"
          class="type-btn">
          מכירה ({{ getTypeCount('sale') }})
        </button>
        <button 
          (click)="setListingType('rent')"
          [class.active]="listingType === 'rent'"
          class="type-btn">
          השכרה ({{ getTypeCount('rent') }})
        </button>
      </div>

      <!-- Search and Filter Bar -->
      <div class="search-filter-bar">
        <div class="search-wrapper">
          <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          <input
            type="text"
            placeholder="חיפוש לפי עיר, שכונה או תיאור..."
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearchChange()"
            class="search-input">
        </div>
        <button 
          (click)="toggleFilters()"
          [class.active]="showFilters"
          class="filter-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="4" x2="4" y1="21" y2="14"/>
            <line x1="4" x2="4" y1="10" y2="3"/>
            <line x1="12" x2="12" y1="21" y2="12"/>
            <line x1="12" x2="12" y1="8" y2="3"/>
            <line x1="20" x2="20" y1="21" y2="16"/>
            <line x1="20" x2="20" y1="12" y2="3"/>
            <line x1="2" x2="6" y1="14" y2="14"/>
            <line x1="10" x2="14" y1="8" y2="8"/>
            <line x1="18" x2="22" y1="16" y2="16"/>
          </svg>
          סינון
        </button>
      </div>

      <!-- Filters Panel -->
      <div *ngIf="showFilters" class="filters-panel">
        <div class="filters-grid">
          <div class="filter-item">
            <label>מחיר מינימום</label>
            <input
              type="number"
              placeholder="0"
              [(ngModel)]="filters.minPrice"
              (ngModelChange)="applyFilters()">
          </div>
          <div class="filter-item">
            <label>מחיר מקסימום</label>
            <input
              type="number"
              placeholder="∞"
              [(ngModel)]="filters.maxPrice"
              (ngModelChange)="applyFilters()">
          </div>
          <div class="filter-item">
            <label>עיר</label>
            <select
              [(ngModel)]="filters.city"
              (ngModelChange)="applyFilters()">
              <option value="">כל הערים</option>
              <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
            </select>
          </div>
          <div class="filter-item">
            <label>מספר חדרים מינימום</label>
            <input
              type="number"
              placeholder="0"
              [(ngModel)]="filters.minRooms"
              (ngModelChange)="applyFilters()">
          </div>
          <div class="filter-item">
            <label>שטח מינימום (מ"ר)</label>
            <input
              type="number"
              placeholder="0"
              [(ngModel)]="filters.minSize"
              (ngModelChange)="applyFilters()">
          </div>
        </div>
        <button (click)="resetFilters()" class="reset-btn">
          איפוס סינון
        </button>
      </div>
    </div>

    <!-- Results Count -->
    <div class="results-count">
      נמצאו {{ filteredApartments.length }} תוצאות
    </div>

    <!-- Listings Grid -->
    <div class="listings-grid">
      <div *ngFor="let apartment of currentListings" 
           (click)="openModal(apartment)"
           class="listing-card">
        <div class="listing-image">
          <img [src]="apartment.image" [alt]="apartment.title">
          <div class="listing-badge">
            <span [class]="apartment.type === 'sale' ? 'badge-sale' : 'badge-rent'">
              {{ apartment.type === 'sale' ? 'מכירה' : 'השכרה' }}
            </span>
          </div>
        </div>
        <div class="listing-content">
          <h3>{{ apartment.title }}</h3>
          <div class="listing-location">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/>
              <circle cx="12" cy="10" r="3"/>
            </svg>
            <span>{{ apartment.city }}, {{ apartment.neighborhood }}</span>
          </div>
          <div class="listing-features">
            <div class="feature">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M2 4v16"/>
                <path d="M2 8h18a2 2 0 0 1 2 2v10"/>
                <path d="M2 17h20"/>
                <path d="M6 8v9"/>
              </svg>
              <span>{{ apartment.rooms }} חדרים</span>
            </div>
            <div class="feature">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 6 6.5 3.5a1.5 1.5 0 0 0-1 0l-1 1a1.5 1.5 0 0 0 0 1L7 9"/>
                <path d="m15 6 2.5-2.5a1.5 1.5 0 0 1 1 0l1 1a1.5 1.5 0 0 1 0 1L17 9"/>
                <path d="M9 18h6"/>
                <path d="M10 22v-5"/>
                <path d="M14 22v-5"/>
              </svg>
              <span>{{ apartment.bathrooms }}</span>
            </div>
            <div class="feature">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect width="18" height="18" x="3" y="3" rx="2"/>
                <path d="M3 9h18"/>
                <path d="M9 21V9"/>
              </svg>
              <span>{{ apartment.size }} מ"ר</span>
            </div>
          </div>
          <div class="listing-price">
            ₪{{ formatPrice(apartment.price) }}
            <span *ngIf="apartment.type === 'rent'"> / חודש</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div *ngIf="totalPages > 1" class="pagination">
      <button 
        (click)="previousPage()"
        [disabled]="currentPage === 1"
        class="pagination-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m9 18 6-6-6-6"/>
        </svg>
      </button>
      
      <button 
        *ngFor="let page of getPagesArray()"
        (click)="changePage(page)"
        [class.active]="currentPage === page"
        class="pagination-number">
        {{ page }}
      </button>
      
      <button 
        (click)="nextPage()"
        [disabled]="currentPage === totalPages"
        class="pagination-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m15 18-6-6 6-6"/>
        </svg>
      </button>
    </div>

    <!-- No Results -->
    <div *ngIf="filteredApartments.length === 0" class="no-results">
      <p>לא נמצאו תוצאות התואמות את החיפוש</p>
    </div>
  </div>

  <!-- Modal -->
       @if(selectedApartment !== null){
  <div  class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-image">
        <img [src]="selectedApartment.image" [alt]="selectedApartment.title">
        <button (click)="closeModal()" class="modal-close">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 6 6 18"/>
            <path d="m6 6 12 12"/>
          </svg>
        </button>
        <div class="modal-badge">
          <span [class]="selectedApartment.type === 'sale' ? 'badge-sale' : 'badge-rent'">
            {{ selectedApartment.type === 'sale' ? 'מכירה' : 'השכרה' }}
          </span>
        </div>
      </div>
      
      <div class="modal-body">
        <h2>{{ selectedApartment.title }}</h2>
        
        <div class="modal-location">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/>
            <circle cx="12" cy="10" r="3"/>
          </svg>
          <span>{{ selectedApartment.city }}, {{ selectedApartment.neighborhood }}</span>
        </div>

        <div class="modal-price">
          ₪{{ formatPrice(selectedApartment.price) }}
          <span *ngIf="selectedApartment.type === 'rent'"> / חודש</span>
        </div>

        <div class="modal-stats">
          <div class="stat-box">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M2 4v16"/>
              <path d="M2 8h18a2 2 0 0 1 2 2v10"/>
              <path d="M2 17h20"/>
              <path d="M6 8v9"/>
            </svg>
            <div>{{ selectedApartment.rooms }} חדרים</div>
          </div>
          <div class="stat-box">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 6 6.5 3.5a1.5 1.5 0 0 0-1 0l-1 1a1.5 1.5 0 0 0 0 1L7 9"/>
              <path d="m15 6 2.5-2.5a1.5 1.5 0 0 1 1 0l1 1a1.5 1.5 0 0 1 0 1L17 9"/>
              <path d="M9 18h6"/>
              <path d="M10 22v-5"/>
              <path d="M14 22v-5"/>
            </svg>
            <div>{{ selectedApartment.bathrooms }} אמבטיות</div>
          </div>
          <div class="stat-box">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect width="18" height="18" x="3" y="3" rx="2"/>
              <path d="M3 9h18"/>
              <path d="M9 21V9"/>
            </svg>
            <div>{{ selectedApartment.size }} מ"ר</div>
          </div>
          <div class="stat-box">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
              <polyline points="9 22 9 12 15 12 15 22"/>
            </svg>
         
                 <div>קומה {{ selectedApartment.floor }}</div>
           
          </div>
        </div>

        <div class="modal-features">
          <h3>תכונות הנכס</h3>
          <div class="features-tags">
            <span *ngFor="let feature of selectedApartment.features" class="feature-tag">
              {{ feature }}
            </span>
          </div>
        </div>

       
         <a href="tel:0583284763" class="contact-btn">
          יצירת קשר
        </a>
      </div>
    </div>
         </div>}
</div>